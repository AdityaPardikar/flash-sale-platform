<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flash Sale Platform - System Architecture</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
        }

        .content {
            padding: 40px;
        }

        h2 {
            color: #667eea;
            font-size: 1.6em;
            margin: 30px 0 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        h3 {
            color: #764ba2;
            font-size: 1.2em;
            margin: 20px 0 15px;
        }

        .code-block {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #667eea;
            font-family: monospace;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow-x: auto;
            margin: 15px 0;
            font-size: 0.85em;
        }

        .box {
            background: #f0f4ff;
            border-left: 4px solid #667eea;
            padding: 20px;
            border-radius: 6px;
            margin: 20px 0;
        }

        .box h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        ul,
        ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        li {
            margin-bottom: 8px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        th,
        td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #667eea;
            color: white;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: bold;
        }

        .badge-success {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .badge-info {
            background: #e3f2fd;
            color: #0d47a1;
        }

        .architecture-diagram {
            background: #f9f9f9;
            border: 2px solid #667eea;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 0.9em;
            line-height: 1.4;
            overflow-x: auto;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.5em;
            }
        }

        .footer {
            background: #f8f9fa;
            padding: 30px;
            text-align: center;
            border-top: 2px solid #e0e0e0;
            color: #666;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ—ï¸ Flash Sale Platform - System Architecture</h1>
        </div>

        <div class="content">
            <div class="box">
                <h4>High-Performance Distributed System</h4>
                <p>Designed to handle 50K+ concurrent users with zero overselling guarantee and fair FIFO queue access.
                </p>
            </div>

            <h2>ğŸ¯ Architecture Overview</h2>

            <div class="architecture-diagram">
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ React Frontend (Vite + Tailwind) â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ â”‚ â”‚
                â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
                â”‚ Nginx â”‚ â”‚ WebSocket â”‚ â”‚ REST API â”‚
                â”‚ LB â”‚ â”‚ (Socket.io) â”‚ â”‚(Express) â”‚
                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                â”‚ â”‚ â”‚
                â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
                â”‚ Node.js Cluster (4+ Instances) â”‚
                â”‚ â€¢ API Routes â”‚
                â”‚ â€¢ Queue Management â”‚
                â”‚ â€¢ Order Processing â”‚
                â”‚ â€¢ Real-time Broadcast â”‚
                â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
                â”‚ â”‚
                â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”
                â”‚ PostgreSQL DB â”‚ â”‚ Redis â”‚
                â”‚ â€¢ Users â”‚ â”‚ â€¢ Queues â”‚
                â”‚ â€¢ Products â”‚ â”‚ â€¢ Sessionsâ”‚
                â”‚ â€¢ Sales â”‚ â”‚ â€¢ Countersâ”‚
                â”‚ â€¢ Orders â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </div>

            <h2>ğŸ“¦ Database Schema</h2>

            <h3>1. Users Table</h3>
            <div class="code-block">CREATE TABLE users (
                id UUID PRIMARY KEY,
                email VARCHAR UNIQUE NOT NULL,
                username VARCHAR UNIQUE NOT NULL,
                password_hash VARCHAR NOT NULL,
                created_at TIMESTAMP DEFAULT NOW(),
                updated_at TIMESTAMP DEFAULT NOW()
                );</div>

            <h3>2. Products Table</h3>
            <div class="code-block">CREATE TABLE products (
                id UUID PRIMARY KEY,
                name VARCHAR NOT NULL,
                description TEXT,
                base_price DECIMAL(10,2) NOT NULL,
                category VARCHAR,
                image_url VARCHAR,
                created_at TIMESTAMP DEFAULT NOW()
                );</div>

            <h3>3. Flash Sales Table</h3>
            <div class="code-block">CREATE TABLE flash_sales (
                id UUID PRIMARY KEY,
                product_id UUID REFERENCES products(id),
                flash_price DECIMAL(10,2) NOT NULL,
                quantity_available INT NOT NULL,
                start_time TIMESTAMP NOT NULL,
                end_time TIMESTAMP NOT NULL,
                status VARCHAR DEFAULT 'upcoming',
                created_at TIMESTAMP DEFAULT NOW()
                );</div>

            <h3>4. Queue Entries Table</h3>
            <div class="code-block">CREATE TABLE queue_entries (
                id UUID PRIMARY KEY,
                user_id UUID REFERENCES users(id),
                flash_sale_id UUID REFERENCES flash_sales(id),
                position INT NOT NULL,
                status VARCHAR DEFAULT 'waiting',
                joined_at TIMESTAMP DEFAULT NOW()
                );</div>

            <h3>5. Orders Table</h3>
            <div class="code-block">CREATE TABLE orders (
                id UUID PRIMARY KEY,
                user_id UUID REFERENCES users(id),
                flash_sale_id UUID REFERENCES flash_sales(id),
                quantity INT NOT NULL,
                total_price DECIMAL(10,2) NOT NULL,
                status VARCHAR DEFAULT 'pending',
                created_at TIMESTAMP DEFAULT NOW()
                );</div>

            <h2>ğŸ’¾ Redis Data Structures</h2>

            <div class="grid-2">
                <div class="box">
                    <h4>Queue (Sorted Set)</h4>
                    <p><strong>Key:</strong> queue:{flash_sale_id}</p>
                    <p><strong>Type:</strong> Sorted Set</p>
                    <p><strong>Members:</strong> User IDs</p>
                    <p><strong>Score:</strong> Join timestamp (FIFO ordering)</p>
                </div>

                <div class="box">
                    <h4>Reservation (Hash)</h4>
                    <p><strong>Key:</strong> reservation:{user_id}:{flash_sale_id}</p>
                    <p><strong>Type:</strong> Hash</p>
                    <p><strong>Fields:</strong> quantity, reserved_at, expires_at</p>
                    <p><strong>TTL:</strong> 5 minutes (auto-expires)</p>
                </div>
            </div>

            <div class="box">
                <h4>Inventory Counter (String)</h4>
                <p><strong>Key:</strong> inventory:{flash_sale_id}</p>
                <p><strong>Type:</strong> String (Integer)</p>
                <p><strong>Operations:</strong> DECR (atomic)</p>
            </div>

            <h2>ğŸ”Œ API Endpoints</h2>

            <table>
                <tr>
                    <th>Category</th>
                    <th>Method</th>
                    <th>Endpoint</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td colspan="4" style="background: #667eea; color: white; font-weight: bold;">Authentication</td>
                </tr>
                <tr>
                    <td>Auth</td>
                    <td><span class="badge badge-info">POST</span></td>
                    <td>/api/v1/auth/register</td>
                    <td>User registration</td>
                </tr>
                <tr>
                    <td>Auth</td>
                    <td><span class="badge badge-info">POST</span></td>
                    <td>/api/v1/auth/login</td>
                    <td>User login</td>
                </tr>
                <tr>
                    <td>Auth</td>
                    <td><span class="badge badge-info">POST</span></td>
                    <td>/api/v1/auth/refresh</td>
                    <td>Token refresh</td>
                </tr>
                <tr>
                    <td colspan="4" style="background: #667eea; color: white; font-weight: bold;">Products</td>
                </tr>
                <tr>
                    <td>Products</td>
                    <td><span class="badge badge-success">GET</span></td>
                    <td>/api/v1/products</td>
                    <td>List products</td>
                </tr>
                <tr>
                    <td>Products</td>
                    <td><span class="badge badge-success">GET</span></td>
                    <td>/api/v1/products/:id</td>
                    <td>Get product details</td>
                </tr>
                <tr>
                    <td colspan="4" style="background: #667eea; color: white; font-weight: bold;">Flash Sales</td>
                </tr>
                <tr>
                    <td>Sales</td>
                    <td><span class="badge badge-success">GET</span></td>
                    <td>/api/v1/flash-sales</td>
                    <td>List active sales</td>
                </tr>
                <tr>
                    <td>Sales</td>
                    <td><span class="badge badge-success">GET</span></td>
                    <td>/api/v1/flash-sales/:id</td>
                    <td>Get sale details</td>
                </tr>
                <tr>
                    <td colspan="4" style="background: #667eea; color: white; font-weight: bold;">Orders & Queue</td>
                </tr>
                <tr>
                    <td>Orders</td>
                    <td><span class="badge badge-info">POST</span></td>
                    <td>/api/v1/orders</td>
                    <td>Create order</td>
                </tr>
                <tr>
                    <td>Orders</td>
                    <td><span class="badge badge-success">GET</span></td>
                    <td>/api/v1/orders</td>
                    <td>List user orders</td>
                </tr>
                <tr>
                    <td>Queue</td>
                    <td><span class="badge badge-info">POST</span></td>
                    <td>/api/v1/queue/join</td>
                    <td>Join queue</td>
                </tr>
                <tr>
                    <td>Queue</td>
                    <td><span class="badge badge-success">GET</span></td>
                    <td>/api/v1/queue/position</td>
                    <td>Check position</td>
                </tr>
            </table>

            <h2>ğŸ”„ WebSocket Events</h2>

            <div class="grid-2">
                <div class="box">
                    <h4>Client to Server</h4>
                    <ul>
                        <li><code>queue:join</code> - Join queue for sale</li>
                        <li><code>queue:leave</code> - Leave queue</li>
                        <li><code>inventory:watch</code> - Watch inventory updates</li>
                    </ul>
                </div>

                <div class="box">
                    <h4>Server to Client</h4>
                    <ul>
                        <li><code>queue:position-update</code> - Queue position changed</li>
                        <li><code>inventory:update</code> - Inventory changed</li>
                        <li><code>sale:status-change</code> - Sale status changed</li>
                        <li><code>order:update</code> - Order status changed</li>
                    </ul>
                </div>
            </div>

            <h2>ğŸ›¡ï¸ Zero Overselling Protection</h2>

            <p>Implemented via Redis Lua script for atomic operations:</p>

            <div class="code-block">-- Decrement inventory atomically
                local key = KEYS[1]
                local quantity = tonumber(ARGV[1])

                local current = redis.call('GET', key)
                if not current or tonumber(current) < quantity then return 0 end redis.call('DECR', key, quantity)
                    return 1</div>

                    <h2>ğŸ“Š Fair Queue System</h2>

                    <ol>
                        <li><strong>User joins</strong> â†’ Added to sorted set with timestamp</li>
                        <li><strong>Position tracking</strong> â†’ Score used for FIFO ordering</li>
                        <li><strong>Checkout window</strong> â†’ Limited time for purchase</li>
                        <li><strong>Position updates</strong> â†’ Broadcast via WebSocket</li>
                    </ol>

                    <h2>ğŸ”„ Order Processing Flow</h2>

                    <ol>
                        <li>User in queue joins checkout</li>
                        <li>Try to reserve inventory (with TTL)</li>
                        <li>If successful, proceed with payment</li>
                        <li>Confirm order</li>
                        <li>If timeout/fail, release reservation</li>
                    </ol>

                    <h2>ğŸ“ˆ Performance Characteristics</h2>

                    <table>
                        <tr>
                            <th>Metric</th>
                            <th>Target</th>
                        </tr>
                        <tr>
                            <td>Throughput</td>
                            <td>50K+ concurrent users</td>
                        </tr>
                        <tr>
                            <td>Queue Operation Latency</td>
                            <td>&lt;100ms</td>
                        </tr>
                        <tr>
                            <td>Consistency</td>
                            <td>Strong (atomic operations)</td>
                        </tr>
                        <tr>
                            <td>Availability</td>
                            <td>99.9% uptime</td>
                        </tr>
                        <tr>
                            <td>Scalability</td>
                            <td>Horizontal (stateless API)</td>
                        </tr>
                    </table>

                    <h2>ğŸ” Security Features</h2>

                    <ul>
                        <li>JWT authentication with 24h expiry</li>
                        <li>Password hashing with bcrypt</li>
                        <li>Rate limiting (100 requests/15 min)</li>
                        <li>CORS configuration</li>
                        <li>Helmet for HTTP security headers</li>
                        <li>Input validation & sanitization</li>
                    </ul>

                    <h2>ğŸ³ Docker Services</h2>

                    <div class="code-block">Services:
                        â€¢ PostgreSQL 16 (primary database)
                        â€¢ Redis 7 (cache & queue)
                        â€¢ Node.js cluster (4+ instances)
                        â€¢ Nginx (load balancer)

                        Environment Variables:
                        DB_HOST=postgres
                        DB_PORT=5432
                        DB_NAME=flash_sale_db
                        REDIS_HOST=redis
                        REDIS_PORT=6379
                        JWT_SECRET=your-secret-key
                        NODE_ENV=production</div>

                    <h2>ğŸ“Š Monitoring & Observability</h2>

                    <ul>
                        <li>Health check endpoints</li>
                        <li>Metrics collection (Prometheus)</li>
                        <li>Log aggregation (ELK)</li>
                        <li>Performance monitoring (APM)</li>
                        <li>Alert system (PagerDuty)</li>
                    </ul>
            </div>

            <div class="footer">
                <h3>Flash Sale Platform Architecture</h3>
                <p>High-performance, scalable system design</p>
                <p>Last Updated: January 25, 2026</p>
            </div>
        </div>
</body>

</html>